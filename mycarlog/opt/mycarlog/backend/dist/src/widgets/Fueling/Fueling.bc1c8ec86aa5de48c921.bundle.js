/*!
 * 
 * [Dojo](https://dojo.io/)
 * Copyright [JS Foundation](https://js.foundation/) & contributors
 * [New BSD license](https://github.com/dojo/meta/blob/master/LICENSE)
 * All rights reserved
 * 
 */
(window.dojoWebpackJsonpmycarlog3=window.dojoWebpackJsonpmycarlog3||[]).push([["src/widgets/Fueling/Fueling"],{293:function(e,t,s){e.exports={" _key":"mycarlog3/CheckBox",icon:"CheckBox-m__icon__e9fe793KV8P",input_hidden:"CheckBox-m__input_hidden__e9fe792qEQP"}},297:function(e,t,s){s(298),e.exports={" _key":"@dojo/widgets/title-pane",title:"title-pane-m__title__3tf5J",closeable:"title-pane-m__closeable__3zOGh",arrow:"title-pane-m__arrow__3vShr",root:"title-pane-m__root__1sOUk",open:"title-pane-m__open__2g2VL",content:"title-pane-m__content__zjzP2",titleButton:"title-pane-m__titleButton__1PgVR",contentTransition:"title-pane-m__contentTransition__1vxdJ"}},298:function(e,t,s){},300:function(e,t,s){s(301),e.exports={" _key":"@dojo/widgets/title-pane",rootFixed:"title-pane-m__rootFixed__oPswN",titleFixed:"title-pane-m__titleFixed__1-iVY",titleButtonFixed:"title-pane-m__titleButtonFixed__3JEqs",contentFixed:"title-pane-m__contentFixed__3kE1q",closeableFixed:"title-pane-m__closeableFixed__x4J9P"}},301:function(e,t,s){},303:function(e,t,s){e.exports={" _key":"mycarlog3/Fueling",spacing:"Fueling-m__spacing__e9fe792WkHZ"}},373:function(e,t,s){"use strict";s.r(t);var i=s(40),o=s(20),a=s(21),n=s(49),c=s(36),l=s(51),r=s(50),d=s(293);class h extends a.b{constructor(){super(...arguments),this.classCheckBox=["fas","fa-square",d.icon],this.idCheckbox="WidgetCheckBox"+(Math.floor(1e5*Math.random())+1),this.Checked=this.properties.value}oncheck(){console.log(this.Checked),this.properties.onValue&&this.properties.onValue(this.Checked),this.Checked?this.classCheckBox=["fas","fa-check-square",d.icon]:this.classCheckBox=["fas","fa-square",d.icon],this.invalidate()}render(){return Object(o.k)("span",{},[Object(o.k)("div",{classes:["field"]},[Object(o.k)("label",{for:this.idCheckbox,classes:["label","is-small"]},[this.properties.label]),Object(o.k)("div",{classes:["control"]},[Object(o.k)("input",{id:this.idCheckbox,type:"checkbox",required:this.properties.required,checked:this.Checked,classes:[d.input_hidden],onchange:e=>{console.log(e),this.Checked=e.target.checked,this.oncheck()}}),Object(o.k)("i",{classes:this.classCheckBox,onclick:e=>{console.log(e),this.Checked=!this.Checked,this.oncheck()}})])])])}}var _=s(41);const u=Object(o.a)({node:o.i}),p={height:0,left:0,top:0,width:0},m={height:0,left:0,top:0,width:0},b={bottom:0,left:0,right:0,top:0},g={height:0,left:0,top:0,width:0},f={width:0,height:0};var v=u(({middleware:{node:e}})=>({get(t){const s=e.get(t);if(!s)return{client:Object.assign({},p),offset:Object.assign({},m),position:Object.assign({},b),scroll:Object.assign({},g),size:Object.assign({},f)};const i=s.getBoundingClientRect();return{client:{height:s.clientHeight,left:s.clientLeft,top:s.clientTop,width:s.clientWidth},offset:{height:s.offsetHeight,left:s.offsetLeft,top:s.offsetTop,width:s.offsetWidth},position:{bottom:i.bottom,left:i.left,right:i.right,top:i.top},scroll:{height:s.scrollHeight,left:s.scrollLeft,top:s.scrollTop,width:s.scrollWidth},size:{width:i.width,height:i.height}}}})),j=s(42),k=s(26),O=s(43),w=s(27),y=s(297),P=s(300);var I=Object(o.a)({dimensions:v,focus:j.a,icache:Object(k.a)(),theme:w.a}).properties()(function({id:e,children:t,properties:s,middleware:{dimensions:i,focus:a,icache:n,theme:c}}){const l=c.classes(y),{closeable:r=!0,headingLevel:d,initialOpen:h,onClose:_,onOpen:u,name:p,theme:m}=s();let{open:b}=s();const g=void 0===n.get("open");if(void 0===b){b=n.get("open"),h!==n.get("initialOpen")&&(n.set("open",h),n.set("initialOpen",h),b=h)}return Object(o.j)("div",{classes:[c.variant(),l.root,b?l.open:null,P.rootFixed]},Object(o.j)("div",{"aria-level":d?`${d}`:null,classes:[l.title,r?l.closeable:null,P.titleFixed,r?P.closeableFixed:null],role:"heading"},Object(o.j)("button",{"aria-controls":`${e}-content`,"aria-expanded":`${b}`,disabled:!r,classes:[P.titleButtonFixed,l.titleButton],focus:a.isFocused("title-button"),key:"title-button",onclick:e=>{e.stopPropagation(),n.set("open",!b),b?_&&_():u&&u()},type:"button"},Object(o.j)("span",{classes:l.arrow},Object(o.j)(O.a,{type:b?"downIcon":"rightIcon",theme:m})),p)),Object(o.j)("div",{"aria-hidden":b?null:"true","aria-labelledby":`${e}-title`,classes:[l.content,!g&&l.contentTransition,P.contentFixed],id:`${e}-content`,key:"content",styles:{marginTop:b?"0px":`-${i.get("content").offset.height}px`}},t()))}),x=s(47),C=s(303);s.d(t,"default",function(){return q});class q extends a.b{constructor(){super(...arguments),this.Params={idfueling:"0",rowkey:0,date_reg:"2020-01-01",idvehicle:0,iduser:"0",odometer:0,quantity:0,idfueltype:"0",price_by_unit:"0",total:0,full_tank:!1,geox:0,geoy:0,address:"",last_lost:!1,note:"",idaccount:0},this._openAddress=!1}SnackBar(e){}async GetAddress(){let e=`[out:json][timeout:10];is_in(${this.Params.geox},${this.Params.geoy})->.a;relation(pivot.a);out tags qt;(way(around:20,${this.Params.geox},${this.Params.geoy}););out tags qt;`,t=await fetch("https://overpass-api.de/api/interpreter",{credentials:"omit",headers:{accept:"*/*","accept-language":"es-ES,es;q=0.9,en;q=0.8","content-type":"application/x-www-form-urlencoded; charset=UTF-8","sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"cross-site"},referrer:`https://www.openstreetmap.org/query?lat=${this.Params.geox}&lon=${this.Params.geoy}`,referrerPolicy:"no-referrer-when-downgrade",body:e,method:"POST",mode:"cors"}),s=await t.json();console.log(s);var i="";s.elements&&s.elements.forEach((e,t)=>{e.tags&&(0==t?i+=e.tags.name:!e.tags.timezone&&e.tags.name&&(i+=", "+e.tags.name)),s.elements.length==t+1&&(this.Params.address=i,this.invalidate(),this.SnackBar(i))})}async Save(){if(console.log(this.Params),this.Params.odometer>0&&Number(this.Params.idvehicle)>0)try{let e=await fetch("/fueling_cu",{method:"POST",body:JSON.stringify(this.Params),headers:{"Content-Type":"application/json"}}),t=await e.json();t.idfueling&&t.idfueling>0?window.location.href="/#fuelinglog":(this.SnackBar("No se pudo guardar"),this.invalidate())}catch(e){this.SnackBar("No se pudo guardar"),this.invalidate()}else this.SnackBar("Complete los campos requerido");this.invalidate()}async onAttach(){if(this.Params.idaccount=window.GlobalStore.get(window.GlobalStore.path("root","user","idaccount")),this.Params.idvehicle=window.GlobalStore.get(window.GlobalStore.path("root","user","preferences","last_vehicle_selected","idvehicle")),this.properties.idfueling){var e=window.location.hash.split("?")[1],t=new URLSearchParams(e);this.Params.idfueling=t.get("idfueling")||"-3";var s="/fueling?idfueling="+this.Params.idfueling;const i=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json"}});if(200==i.status){let e=await i.json();e.length>0&&(this.Params=e[0])}console.log(i),this.invalidate()}}getLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{this.Params.geox=e.coords.latitude,this.Params.geoy=e.coords.longitude,this.invalidate(),this.Params.address.length<2&&this.GetAddress().then()}):this.SnackBar("No se pudo obtener las coordenadas")}render(){return Object(o.k)("div",{},[Object(o.l)(x.a,{}),Object(o.l)(c.a,{title:"Abastecimiento",ShowSave:!0,onSave:()=>{this.Save()}},[]),Object(o.k)("div",{},[Object(o.k)("div",{classes:["columns is-mobile",C.spacing]},[Object(o.k)("div",{classes:["column"]},[Object(o.l)(h,{label:"Tanque lleno",value:this.Params.full_tank,onValue:e=>{this.Params.full_tank=e,console.log(this.Params.full_tank),this.invalidate()}})]),Object(o.k)("div",{classes:["column"]},[Object(o.l)(n.a,{type:"text",label:"Odómetro",required:!0,value:this.Params.odometer,onValue:e=>{this.Params.odometer=Number(e),this.invalidate()}})])]),Object(o.k)("div",{classes:["columns is-mobile",C.spacing]},[Object(o.k)("div",{classes:["column"]},[Object(o.l)(n.a,{type:"text",label:"quantity",required:!0,value:this.Params.quantity,onValue:e=>{this.Params.quantity=Number(e),this.invalidate()}})]),Object(o.k)("div",{classes:["column"]},[Object(o.l)(l.a,{label:"Tipo Combustible",value:this.Params.idfueltype,url:"/toselect/fueltypes",onValue:e=>{this.Params.idfueltype=e}})])]),Object(o.k)("div",{classes:["columns is-mobile",C.spacing]},[Object(o.k)("div",{classes:["column"]},[Object(o.l)(n.a,{type:"number",label:"Precio x Unidad",value:this.Params.price_by_unit,onValue:e=>{this.Params.price_by_unit=e,this.invalidate()}})]),Object(o.k)("div",{classes:["column"]},[Object(o.l)(n.a,{type:"number",label:"Costo Total",value:this.Params.total,onValue:e=>{this.Params.total=Number(e),this.invalidate()}})])]),Object(o.k)("div",{classes:["columns is-mobile",C.spacing]},[Object(o.k)("div",{classes:["column"]},[Object(o.l)(n.a,{type:"date",label:"Fecha",required:!0,placeholder:"Fecha",value:this.Params.date_reg,onValue:e=>{this.Params.date_reg=e,this.invalidate()}})]),Object(o.k)("div",{classes:["column"]},[Object(o.l)(n.a,{type:"text",label:"Hora",required:!0,placeholder:"Hora",value:this.Params.date_reg,onValue:e=>{this.Params.date_reg=e,this.invalidate()}})])]),Object(o.k)("div",{classes:["columns is-mobile",C.spacing]},[Object(o.k)("div",{classes:["column"]},[Object(o.l)(h,{value:this.Params.last_lost,label:"Última recarga perdida",onValue:e=>{this.Params.last_lost=e,console.log(this.Params.last_lost),this.invalidate()}})]),Object(o.k)("div",{classes:["column"]},[])]),Object(o.k)("div",{classes:["columns is-mobile",C.spacing]},[Object(o.k)("div",{classes:["column"]},[Object(o.l)(I,{name:"Punto de abastecimiento",open:this._openAddress,onOpen:()=>{this._openAddress=!0,this.getLocation(),console.log("Abrió pane")},onClose:()=>{this._openAddress=!1,console.log("Cerró pane")}},[Object(o.k)("div",{},[Object(o.k)("div",{classes:["columns is-mobile",C.spacing]},[Object(o.k)("div",{classes:["column"]},[Object(o.l)(n.a,{type:"number",label:"Coordenada Y",value:this.Params.geoy,onValue:e=>{this.Params.geoy=0,this.invalidate()}})]),Object(o.k)("div",{classes:["column"]},[Object(o.l)(n.a,{type:"number",label:"Coordenada X",value:this.Params.geox,onValue:e=>{this.Params.geox=0,this.invalidate()}})])]),Object(o.k)("div",{classes:C.spacing},[Object(o.l)(r.a,{label:"Dirección",rows:3,placeholder:"Dirección",value:this.Params.address,onValue:e=>{this.Params.address=e,this.invalidate()}})])])])])]),Object(o.k)("div",{classes:[C.spacing]},[Object(o.l)(r.a,{rows:5,placeholder:"Notas",label:"Notas",key:"text-area",value:this.Params.note,onValue:e=>{this.Params.note=e,this.invalidate()}})])])])}}i.a([Object(_.a)()],q.prototype,"Params",void 0),i.a([Object(_.a)()],q.prototype,"_openAddress",void 0)},43:function(e,t,s){"use strict";var i=s(20),o=s(27),a=s(28),n=s(54),c=s(44);const l=Object(i.a)({theme:o.a}).properties()(function({properties:e,middleware:{theme:t}}){const{aria:s={hidden:"true"},type:o,altText:l,size:r}=e(),d=t.classes(n),h=r&&d[r];return Object(i.j)("virtual",null,Object(i.j)("i",Object.assign({classes:[t.variant(),d.icon,d[o],h]},Object(a.b)(s))),l?Object(i.j)("span",{classes:c.visuallyHidden},l):null)});t.a=l},50:function(e,t,s){"use strict";s.d(t,"a",function(){return a});var i=s(20),o=s(21);class a extends o.b{render(){return Object(i.k)("span",{},[Object(i.k)("div",{classes:["field"]},[Object(i.k)("label",{classes:["label","is-small"]},[this.properties.label]),Object(i.k)("div",{classes:["control"]},[Object(i.k)("textarea",{rows:this.properties.rows,cols:this.properties.cols,required:this.properties.required,placeholder:this.properties.placeholder,classes:["textarea","is-small"],value:this.properties.value,onchange:e=>{this.properties.onValue&&this.properties.onValue(e.target.value),console.log("Click")}},[this.properties.value])])])])}}},51:function(e,t,s){"use strict";s.d(t,"a",function(){return n});var i=s(20),o=s(21),a=s(52);class n extends o.b{constructor(){super(...arguments),this.RemoteOptions=[],this.Options=[]}async onAttach(){try{let e=await fetch(this.properties.url,{method:"POST",body:JSON.stringify(this.properties.params),headers:{"Content-Type":"application/json"}});if(200==e.status){let t=await e.json();this.RemoteOptions=t,this.Options=[],await this.RemoteOptions.forEach((e,t)=>{this.Options.push(Object(i.k)("option",{value:e.value},[e.label])),this.invalidate()}),console.log("Opciones",this.Options.length)}else 401==e.status&&(window.location.href="/#login")}catch(e){console.log(e),this.invalidate()}}render(){return Object(i.k)("span",{},[Object(i.k)("div",{classes:["field"]},[Object(i.k)("label",{classes:["label","is-small"]},[this.properties.label]),Object(i.k)("div",{classes:["control","is-small"]},[Object(i.k)("div",{classes:["select is-small",a.full_width]},[Object(i.k)("select",{required:this.properties.required,onchange:e=>{this.properties.onValue&&this.properties.onValue(e.target.value),console.log("Click",e.target,e)}},this.Options)])])])])}}},52:function(e,t,s){e.exports={" _key":"mycarlog3/SelectRemoteSource",full_width:"SelectRemoteSource-m__full_width__e9fe791RePL"}},54:function(e,t,s){s(55),e.exports={" _key":"@dojo/widgets/icon",root:"icon-m__root__1eoV_",medium:"icon-m__medium__3Xwur",large:"icon-m__large__Ml3b4",small:"icon-m__small__2BbOV",icon:"icon-m__icon__UdYI1",clockIcon:"icon-m__clockIcon__3GLpu",downIcon:"icon-m__downIcon__2q5lh",leftIcon:"icon-m__leftIcon__pBWIt",rightIcon:"icon-m__rightIcon__18AW6",closeIcon:"icon-m__closeIcon__21KIr",plusIcon:"icon-m__plusIcon__2b4l_",minusIcon:"icon-m__minusIcon__1DHfu",checkIcon:"icon-m__checkIcon__2D3mV",upIcon:"icon-m__upIcon__2Whg2",upAltIcon:"icon-m__upAltIcon__2GXtu",downAltIcon:"icon-m__downAltIcon__hm7FZ",searchIcon:"icon-m__searchIcon__2HGOw",barsIcon:"icon-m__barsIcon__2e0Qo",settingsIcon:"icon-m__settingsIcon__2-UEA",alertIcon:"icon-m__alertIcon__WjF2F",helpIcon:"icon-m__helpIcon__3c7_4",infoIcon:"icon-m__infoIcon__PXtvl",cancelIcon:"icon-m__cancelIcon__2ey9p",checkedBoxIcon:"icon-m__checkedBoxIcon__TSG-9",phoneIcon:"icon-m__phoneIcon__2BO7g",editIcon:"icon-m__editIcon__3j9QX",dateIcon:"icon-m__dateIcon__3vXGn",linkIcon:"icon-m__linkIcon__314xM",locationIcon:"icon-m__locationIcon__1uwwo",secureIcon:"icon-m__secureIcon__UXrMt",mailIcon:"icon-m__mailIcon__3uh6Q",eyeIcon:"icon-m__eyeIcon__2Cqqq",eyeSlashIcon:"icon-m__eyeSlashIcon__17wRy",starIcon:"icon-m__starIcon__r0lYz"}},55:function(e,t,s){}}]);
//# sourceMappingURL=Fueling.bc1c8ec86aa5de48c921.bundle.js.map