/*!
 * 
 * [Dojo](https://dojo.io/)
 * Copyright [JS Foundation](https://js.foundation/) & contributors
 * [New BSD license](https://github.com/dojo/meta/blob/master/LICENSE)
 * All rights reserved
 * 
 */
(window.dojoWebpackJsonpmycarlog3=window.dojoWebpackJsonpmycarlog3||[]).push([["src/widgets/Fueling/Fueling"],{25:function(e,t,i){"use strict";var s=i(20),o=i(26),a=i(48);const n=Object(s.a)({coreTheme:o.a});function c(e){return`${e.charAt(0).toUpperCase()}${e.slice(1)}`}function l(e){return e&&e.hasOwnProperty("variant")}const r=n(function({middleware:{coreTheme:e},properties:t}){return Object.assign({compose:(i,s,o)=>{const n=function(){const{theme:i}=t();if(i)return i;const s=e.get();return Object(a.b)(s)?{theme:s.theme,variant:s.variant}:s?s.theme:void 0}(),r=i[" _key"],d=s[" _key"],h=Object.keys(i).reduce((e,t)=>" _key"===t?e:(o&&!e[`${o}${c(t)}`]&&(e[`${o}${c(t)}`]=" "),s[t]||(e[t]=" "),e),{" _key":d}),u=e.classes(h),_=e.classes(s);let m=e.classes(i);if(o){const e=Object.keys(Object.assign({},u,_)).reduce((e,t)=>{if(0===t.indexOf(o)&&t!==o){const i=function(e){return`${e.charAt(0).toLowerCase()}${e.slice(1)}`}(t.replace(o,""));!_[t]&&u[t]&&u[t].trim()&&(e[i]=`${m[i]} ${u[t].trim()}`),_[t]&&(e[i]=_[t])}return e},{});return m=Object.assign({},m,e),l(n)?{theme:{theme:Object.assign({},n.theme.theme,{[r]:m}),variants:n.theme.variants},variant:n.variant}:Object.assign({},n,{[r]:m})}const p=Object.keys(m).reduce((e,t)=>{if(" _key"===t)return e;const i=_[t]&&_[t].trim();return _[t]?e[t]=i:u[t]&&u[t].trim()&&(e[t]=`${e[t]} ${u[t].trim()}`),e},Object.assign({},m));return l(n)?{theme:{theme:Object.assign({},n.theme.theme,{[r]:p}),variants:n.theme.variants},variant:n.variant}:Object.assign({},n,{[r]:p})}},e)});t.a=r},271:function(e,t,i){e.exports={" _key":"mycarlog3/CheckBox",icon:"CheckBox-m__icon__e9fe793KV8P",input_hidden:"CheckBox-m__input_hidden__e9fe792qEQP"}},273:function(e,t,i){i(274),e.exports={" _key":"@dojo/widgets/icon",root:"icon-m__root__1eoV_",medium:"icon-m__medium__3Xwur",large:"icon-m__large__Ml3b4",small:"icon-m__small__2BbOV",icon:"icon-m__icon__UdYI1",clockIcon:"icon-m__clockIcon__3GLpu",downIcon:"icon-m__downIcon__2q5lh",leftIcon:"icon-m__leftIcon__pBWIt",rightIcon:"icon-m__rightIcon__18AW6",closeIcon:"icon-m__closeIcon__21KIr",plusIcon:"icon-m__plusIcon__2b4l_",minusIcon:"icon-m__minusIcon__1DHfu",checkIcon:"icon-m__checkIcon__2D3mV",upIcon:"icon-m__upIcon__2Whg2",upAltIcon:"icon-m__upAltIcon__2GXtu",downAltIcon:"icon-m__downAltIcon__hm7FZ",searchIcon:"icon-m__searchIcon__2HGOw",barsIcon:"icon-m__barsIcon__2e0Qo",settingsIcon:"icon-m__settingsIcon__2-UEA",alertIcon:"icon-m__alertIcon__WjF2F",helpIcon:"icon-m__helpIcon__3c7_4",infoIcon:"icon-m__infoIcon__PXtvl",cancelIcon:"icon-m__cancelIcon__2ey9p",checkedBoxIcon:"icon-m__checkedBoxIcon__TSG-9",phoneIcon:"icon-m__phoneIcon__2BO7g",editIcon:"icon-m__editIcon__3j9QX",dateIcon:"icon-m__dateIcon__3vXGn",linkIcon:"icon-m__linkIcon__314xM",locationIcon:"icon-m__locationIcon__1uwwo",secureIcon:"icon-m__secureIcon__UXrMt",mailIcon:"icon-m__mailIcon__3uh6Q",eyeIcon:"icon-m__eyeIcon__2Cqqq",eyeSlashIcon:"icon-m__eyeSlashIcon__17wRy",starIcon:"icon-m__starIcon__r0lYz"}},274:function(e,t,i){},276:function(e,t,i){i(277),e.exports={" _key":"@dojo/widgets/title-pane",title:"title-pane-m__title__3tf5J",closeable:"title-pane-m__closeable__3zOGh",arrow:"title-pane-m__arrow__3vShr",root:"title-pane-m__root__1sOUk",open:"title-pane-m__open__2g2VL",content:"title-pane-m__content__zjzP2",titleButton:"title-pane-m__titleButton__1PgVR",contentTransition:"title-pane-m__contentTransition__1vxdJ"}},277:function(e,t,i){},279:function(e,t,i){i(280),e.exports={" _key":"@dojo/widgets/title-pane",rootFixed:"title-pane-m__rootFixed__oPswN",titleFixed:"title-pane-m__titleFixed__1-iVY",titleButtonFixed:"title-pane-m__titleButtonFixed__3JEqs",contentFixed:"title-pane-m__contentFixed__3kE1q",closeableFixed:"title-pane-m__closeableFixed__x4J9P"}},280:function(e,t,i){},282:function(e,t,i){e.exports={" _key":"mycarlog3/Fueling",spacing:"Fueling-m__spacing__e9fe792WkHZ"}},310:function(e,t,i){"use strict";i.r(t);var s=i(31),o=i(20),a=i(21),n=i(39),c=i(33),l=i(41),r=i(40),d=i(271);class h extends a.a{constructor(){super(...arguments),this.classCheckBox=["fas","fa-square",d.icon],this.idCheckbox="WidgetCheckBox"+(Math.floor(1e5*Math.random())+1),this.Checked=this.properties.value}oncheck(){console.log(this.Checked),this.properties.onValue&&this.properties.onValue(this.Checked),this.Checked?this.classCheckBox=["fas","fa-check-square",d.icon]:this.classCheckBox=["fas","fa-square",d.icon],this.invalidate()}render(){return Object(o.i)("span",{},[Object(o.i)("div",{classes:["field"]},[Object(o.i)("label",{for:this.idCheckbox,classes:["label","is-small"]},[this.properties.label]),Object(o.i)("div",{classes:["control"]},[Object(o.i)("input",{id:this.idCheckbox,type:"checkbox",required:this.properties.required,checked:this.Checked,classes:[d.input_hidden],onchange:e=>{console.log(e),this.Checked=e.target.checked,this.oncheck()}}),Object(o.i)("i",{classes:this.classCheckBox,onclick:e=>{console.log(e),this.Checked=!this.Checked,this.oncheck()}})])])])}}var u=i(32);const _=Object(o.a)({node:o.g}),m={height:0,left:0,top:0,width:0},p={height:0,left:0,top:0,width:0},b={bottom:0,left:0,right:0,top:0},g={height:0,left:0,top:0,width:0},f={width:0,height:0};var v=_(({middleware:{node:e}})=>({get(t){const i=e.get(t);if(!i)return{client:Object.assign({},m),offset:Object.assign({},p),position:Object.assign({},b),scroll:Object.assign({},g),size:Object.assign({},f)};const s=i.getBoundingClientRect();return{client:{height:i.clientHeight,left:i.clientLeft,top:i.clientTop,width:i.clientWidth},offset:{height:i.offsetHeight,left:i.offsetLeft,top:i.offsetTop,width:i.offsetWidth},position:{bottom:s.bottom,left:s.left,right:s.right,top:s.top},scroll:{height:i.scrollHeight,left:i.scrollLeft,top:i.scrollTop,width:i.scrollWidth},size:{width:s.width,height:s.height}}}})),j=i(44),O=i(22),y=i(25),w=i(34),k=i(273),P=i(45);var x=Object(o.a)({theme:y.a}).properties()(function({properties:e,middleware:{theme:t}}){const{aria:i={hidden:"true"},type:s,altText:a,size:n}=e(),c=t.classes(k),l=n&&c[n];return Object(o.h)("virtual",null,Object(o.h)("i",Object.assign({classes:[t.variant(),c.icon,c[s],l]},Object(w.a)(i))),a?Object(o.h)("span",{classes:P.visuallyHidden},a):null)}),I=i(276),C=i(279);var S=Object(o.a)({dimensions:v,focus:j.a,icache:Object(O.a)(),theme:y.a}).properties()(function({id:e,children:t,properties:i,middleware:{dimensions:s,focus:a,icache:n,theme:c}}){const l=c.classes(I),{closeable:r=!0,headingLevel:d,initialOpen:h,onClose:u,onOpen:_,name:m,theme:p}=i();let{open:b}=i();const g=void 0===n.get("open");if(void 0===b){b=n.get("open"),h!==n.get("initialOpen")&&(n.set("open",h),n.set("initialOpen",h),b=h)}return Object(o.h)("div",{classes:[c.variant(),l.root,b?l.open:null,C.rootFixed]},Object(o.h)("div",{"aria-level":d?`${d}`:null,classes:[l.title,r?l.closeable:null,C.titleFixed,r?C.closeableFixed:null],role:"heading"},Object(o.h)("button",{"aria-controls":`${e}-content`,"aria-expanded":`${b}`,disabled:!r,classes:[C.titleButtonFixed,l.titleButton],focus:a.isFocused("title-button"),key:"title-button",onclick:e=>{e.stopPropagation(),n.set("open",!b),b?u&&u():_&&_()},type:"button"},Object(o.h)("span",{classes:l.arrow},Object(o.h)(x,{type:b?"downIcon":"rightIcon",theme:p})),m)),Object(o.h)("div",{"aria-hidden":b?null:"true","aria-labelledby":`${e}-title`,classes:[l.content,!g&&l.contentTransition,C.contentFixed],id:`${e}-content`,key:"content",styles:{marginTop:b?"0px":`-${s.get("content").offset.height}px`}},t()))}),q=i(35),F=i(282);i.d(t,"default",function(){return B});class B extends a.a{constructor(){super(...arguments),this.Params={idfueling:"0",rowkey:0,date_reg:"2020-01-01",idvehicle:0,iduser:"0",odometer:0,quantity:0,idfueltype:"0",price_by_unit:"0",total:0,full_tank:!1,geox:0,geoy:0,address:"",last_lost:!1,note:"",idaccount:0},this._openAddress=!1}SnackBar(e){}async GetAddress(){let e=`[out:json][timeout:10];is_in(${this.Params.geox},${this.Params.geoy})->.a;relation(pivot.a);out tags qt;(way(around:20,${this.Params.geox},${this.Params.geoy}););out tags qt;`,t=await fetch("https://overpass-api.de/api/interpreter",{credentials:"omit",headers:{accept:"*/*","accept-language":"es-ES,es;q=0.9,en;q=0.8","content-type":"application/x-www-form-urlencoded; charset=UTF-8","sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"cross-site"},referrer:`https://www.openstreetmap.org/query?lat=${this.Params.geox}&lon=${this.Params.geoy}`,referrerPolicy:"no-referrer-when-downgrade",body:e,method:"POST",mode:"cors"}),i=await t.json();console.log(i);var s="";i.elements&&i.elements.forEach((e,t)=>{e.tags&&(0==t?s+=e.tags.name:!e.tags.timezone&&e.tags.name&&(s+=", "+e.tags.name)),i.elements.length==t+1&&(this.Params.address=s,this.invalidate(),this.SnackBar(s))})}async Save(){if(console.log(this.Params),this.Params.odometer>0&&Number(this.Params.idvehicle)>0)try{let e=await fetch("/fueling_cu",{method:"POST",body:JSON.stringify(this.Params),headers:{"Content-Type":"application/json"}}),t=await e.json();t.idfueling&&t.idfueling>0?window.location.href="/#fuelinglog":(this.SnackBar("No se pudo guardar"),this.invalidate())}catch(e){this.SnackBar("No se pudo guardar"),this.invalidate()}else this.SnackBar("Complete los campos requerido");this.invalidate()}async onAttach(){if(this.Params.idaccount=window.GlobalStore.get(window.GlobalStore.path("root","user","idaccount")),this.Params.idvehicle=window.GlobalStore.get(window.GlobalStore.path("root","user","preferences","last_vehicle_selected","idvehicle")),this.properties.idfueling){var e=window.location.hash.split("?")[1],t=new URLSearchParams(e);this.Params.idfueling=t.get("idfueling")||"-3";var i="/fueling?idfueling="+this.Params.idfueling;const s=await fetch(i,{method:"GET",headers:{"Content-Type":"application/json"}});if(200==s.status){let e=await s.json();e.length>0&&(this.Params=e[0])}console.log(s),this.invalidate()}}getLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{this.Params.geox=e.coords.latitude,this.Params.geoy=e.coords.longitude,this.invalidate(),this.Params.address.length<2&&this.GetAddress().then()}):this.SnackBar("No se pudo obtener las coordenadas")}render(){return Object(o.i)("div",{},[Object(o.j)(q.a,{}),Object(o.j)(c.a,{title:"Abastecimiento",ShowSave:!0,onSave:()=>{this.Save()}},[]),Object(o.i)("div",{},[Object(o.i)("div",{classes:["columns is-mobile",F.spacing]},[Object(o.i)("div",{classes:["column"]},[Object(o.j)(h,{label:"Tanque lleno",value:this.Params.full_tank,onValue:e=>{this.Params.full_tank=e,console.log(this.Params.full_tank),this.invalidate()}})]),Object(o.i)("div",{classes:["column"]},[Object(o.j)(n.a,{type:"text",label:"Odómetro",required:!0,value:this.Params.odometer,onValue:e=>{this.Params.odometer=Number(e),this.invalidate()}})])]),Object(o.i)("div",{classes:["columns is-mobile",F.spacing]},[Object(o.i)("div",{classes:["column"]},[Object(o.j)(n.a,{type:"text",label:"quantity",required:!0,value:this.Params.quantity,onValue:e=>{this.Params.quantity=Number(e),this.invalidate()}})]),Object(o.i)("div",{classes:["column"]},[Object(o.j)(l.a,{label:"Tipo Combustible",value:this.Params.idfueltype,url:"/toselect/fueltypes",onValue:e=>{this.Params.idfueltype=e}})])]),Object(o.i)("div",{classes:["columns is-mobile",F.spacing]},[Object(o.i)("div",{classes:["column"]},[Object(o.j)(n.a,{type:"number",label:"Precio x Unidad",value:this.Params.price_by_unit,onValue:e=>{this.Params.price_by_unit=e,this.invalidate()}})]),Object(o.i)("div",{classes:["column"]},[Object(o.j)(n.a,{type:"number",label:"Costo Total",value:this.Params.total,onValue:e=>{this.Params.total=Number(e),this.invalidate()}})])]),Object(o.i)("div",{classes:["columns is-mobile",F.spacing]},[Object(o.i)("div",{classes:["column"]},[Object(o.j)(n.a,{type:"date",label:"Fecha",required:!0,placeholder:"Fecha",value:this.Params.date_reg,onValue:e=>{this.Params.date_reg=e,this.invalidate()}})]),Object(o.i)("div",{classes:["column"]},[Object(o.j)(n.a,{type:"text",label:"Hora",required:!0,placeholder:"Hora",value:this.Params.date_reg,onValue:e=>{this.Params.date_reg=e,this.invalidate()}})])]),Object(o.i)("div",{classes:["columns is-mobile",F.spacing]},[Object(o.i)("div",{classes:["column"]},[Object(o.j)(h,{value:this.Params.last_lost,label:"Última recarga perdida",onValue:e=>{this.Params.last_lost=e,console.log(this.Params.last_lost),this.invalidate()}})]),Object(o.i)("div",{classes:["column"]},[])]),Object(o.i)("div",{classes:["columns is-mobile",F.spacing]},[Object(o.i)("div",{classes:["column"]},[Object(o.j)(S,{name:"Punto de abastecimiento",open:this._openAddress,onOpen:()=>{this._openAddress=!0,this.getLocation(),console.log("Abrió pane")},onClose:()=>{this._openAddress=!1,console.log("Cerró pane")}},[Object(o.i)("div",{},[Object(o.i)("div",{classes:["columns is-mobile",F.spacing]},[Object(o.i)("div",{classes:["column"]},[Object(o.j)(n.a,{type:"number",label:"Coordenada Y",value:this.Params.geoy,onValue:e=>{this.Params.geoy=0,this.invalidate()}})]),Object(o.i)("div",{classes:["column"]},[Object(o.j)(n.a,{type:"number",label:"Coordenada X",value:this.Params.geox,onValue:e=>{this.Params.geox=0,this.invalidate()}})])]),Object(o.i)("div",{classes:F.spacing},[Object(o.j)(r.a,{label:"Dirección",rows:3,placeholder:"Dirección",value:this.Params.address,onValue:e=>{this.Params.address=e,this.invalidate()}})])])])])]),Object(o.i)("div",{classes:[F.spacing]},[Object(o.j)(r.a,{rows:5,placeholder:"Notas",label:"Notas",key:"text-area",value:this.Params.note,onValue:e=>{this.Params.note=e,this.invalidate()}})])])])}}s.a([Object(u.a)()],B.prototype,"Params",void 0),s.a([Object(u.a)()],B.prototype,"_openAddress",void 0)},34:function(e,t,i){"use strict";var s;function o(e){return Object.keys(e).reduce((t,i)=>(t[`aria-${i.toLowerCase()}`]=e[i],t),{})}i.d(t,"a",function(){return o}),function(e){e[e.Down=40]="Down",e[e.End=35]="End",e[e.Enter=13]="Enter",e[e.Escape=27]="Escape",e[e.Home=36]="Home",e[e.Left=37]="Left",e[e.PageDown=34]="PageDown",e[e.PageUp=33]="PageUp",e[e.Right=39]="Right",e[e.Space=32]="Space",e[e.Tab=9]="Tab",e[e.Up=38]="Up"}(s||(s={}))},40:function(e,t,i){"use strict";i.d(t,"a",function(){return a});var s=i(20),o=i(21);class a extends o.a{render(){return Object(s.i)("span",{},[Object(s.i)("div",{classes:["field"]},[Object(s.i)("label",{classes:["label","is-small"]},[this.properties.label]),Object(s.i)("div",{classes:["control"]},[Object(s.i)("textarea",{rows:this.properties.rows,cols:this.properties.cols,required:this.properties.required,placeholder:this.properties.placeholder,classes:["textarea","is-small"],value:this.properties.value,onchange:e=>{this.properties.onValue&&this.properties.onValue(e.target.value),console.log("Click")}},[this.properties.value])])])])}}},41:function(e,t,i){"use strict";i.d(t,"a",function(){return n});var s=i(20),o=i(21),a=i(42);class n extends o.a{constructor(){super(...arguments),this.RemoteOptions=[],this.Options=[]}async onAttach(){try{let e=await fetch(this.properties.url,{method:"POST",body:JSON.stringify(this.properties.params),headers:{"Content-Type":"application/json"}});if(200==e.status){let t=await e.json();this.RemoteOptions=t,this.Options=[],await this.RemoteOptions.forEach((e,t)=>{this.Options.push(Object(s.i)("option",{value:e.value},[e.label])),this.invalidate()}),console.log("Opciones",this.Options.length)}else 401==e.status&&(window.location.href="/#login")}catch(e){console.log(e),this.invalidate()}}render(){return Object(s.i)("span",{},[Object(s.i)("div",{classes:["field"]},[Object(s.i)("label",{classes:["label","is-small"]},[this.properties.label]),Object(s.i)("div",{classes:["control","is-small"]},[Object(s.i)("div",{classes:["select is-small",a.full_width]},[Object(s.i)("select",{required:this.properties.required,onchange:e=>{this.properties.onValue&&this.properties.onValue(e.target.value),console.log("Click",e.target,e)}},this.Options)])])])])}}},42:function(e,t,i){e.exports={" _key":"mycarlog3/SelectRemoteSource",full_width:"SelectRemoteSource-m__full_width__e9fe791RePL"}},44:function(e,t,i){"use strict";var s=i(0),o=i(20),a=i(22);const n=Object(a.a)(),c=Object(o.a)({icache:n,diffProperty:o.d,node:o.g,destroy:o.c,invalidator:o.f}).properties()(({middleware:{icache:e,diffProperty:t,node:i,destroy:o,invalidator:a}})=>{let n,c=!1,l=0;const r=new Set;function d(){const e=s.default.document.activeElement;(r.has(n)||r.has(e))&&n!==e&&a(),n=e}return t("focus",(t,i)=>{if(i.focus&&i.focus()){const t=e.getOrSet("current",0);e.set("current",t+1)}}),o(()=>{s.default.document.removeEventListener("focusin",d),s.default.document.removeEventListener("focusout",d),r.clear()}),{shouldFocus(){const t=e.get("current")||0,i=t!==l;return l=t,i},focus(){const t=e.getOrSet("current",0);e.set("current",t+1)},isFocused(e){const t=i.get(e);return!!t&&(r.add(t),c||(s.default.document.addEventListener("focusin",d),s.default.document.addEventListener("focusout",d),c=!0),s.default.document.activeElement===t)}}});t.a=c},45:function(e,t,i){i(46),e.exports={" _key":"@dojo/widgets/base",visuallyHidden:"base-m__visuallyHidden__1AeWe",focusable:"base-m__focusable__1_qAN",hidden:"base-m__hidden__3QddU"}},46:function(e,t,i){}}]);
//# sourceMappingURL=Fueling.0249928e1693972344c2.bundle.js.map